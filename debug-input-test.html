<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å…¥åŠ›ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #222;
        color: white;
      }
      .debug-panel {
        background: #333;
        padding: 20px;
        border-radius: 10px;
        margin: 10px 0;
      }
      .key-display {
        font-family: monospace;
        background: #111;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .active {
        background: #4caf50;
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ® å…¥åŠ›ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</h1>

    <div class="debug-panel">
      <h3>ã‚­ãƒ¼å…¥åŠ›çŠ¶æ…‹</h3>
      <div class="key-display" id="key-status">ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„...</div>
    </div>

    <div class="debug-panel">
      <h3>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹</h3>
      <div class="key-display" id="action-status">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¾…æ©Ÿä¸­...</div>
    </div>

    <div class="debug-panel">
      <h3>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…¥åŠ›</h3>
      <div class="key-display" id="player-input">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…¥åŠ›å¾…æ©Ÿä¸­...</div>
    </div>

    <div class="debug-panel">
      <h3>ãƒ†ã‚¹ãƒˆçµæœ</h3>
      <div class="key-display" id="test-results">ãƒ†ã‚¹ãƒˆé–‹å§‹å‰...</div>
    </div>

    <script src="js/input-manager.js"></script>
    <script>
      let inputManager;
      let testResults = [];

      // å…¥åŠ›ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–
      function initInputManager() {
        try {
          inputManager = new InputManager();
          console.log("InputManager initialized successfully");
          testResults.push("âœ… InputManageråˆæœŸåŒ–æˆåŠŸ");
          startInputTest();
        } catch (error) {
          console.error("InputManager initialization failed:", error);
          testResults.push("âŒ InputManageråˆæœŸåŒ–å¤±æ•—: " + error.message);
          updateTestResults();
        }
      }

      // å…¥åŠ›ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹
      function startInputTest() {
        setInterval(() => {
          if (inputManager) {
            inputManager.update();
            updateDebugDisplay();
          }
        }, 16); // 60FPS
      }

      // ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºã‚’æ›´æ–°
      function updateDebugDisplay() {
        const debugInfo = inputManager.getDebugInfo();
        const playerInput = inputManager.getPlayerInput();

        // ã‚­ãƒ¼çŠ¶æ…‹è¡¨ç¤º
        document.getElementById("key-status").innerHTML = `
                æŠ¼ã•ã‚Œã¦ã„ã‚‹ã‚­ãƒ¼: ${
                  debugInfo.pressedKeys.join(", ") || "ãªã—"
                }<br>
                ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${
                  debugInfo.activeActions.join(", ") || "ãªã—"
                }<br>
                è¿½è·¡ä¸­ã®ã‚­ãƒ¼æ•°: ${debugInfo.totalKeysTracked}
            `;

        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹è¡¨ç¤º
        document.getElementById("action-status").innerHTML = `
                moveLeft: ${inputManager.isActionHeld("moveLeft")}<br>
                moveRight: ${inputManager.isActionHeld("moveRight")}<br>
                jump: ${inputManager.isActionHeld(
                  "jump"
                )} (pressed: ${inputManager.isActionPressed("jump")})<br>
                dash: ${inputManager.isActionHeld("dash")}<br>
                block: ${inputManager.isActionHeld("block")}<br>
                pause: ${inputManager.isActionPressed("pause")}<br>
                enter: ${inputManager.isActionPressed("enter")}
            `;

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å…¥åŠ›è¡¨ç¤º
        document.getElementById("player-input").innerHTML = `
                moveLeft: ${playerInput.moveLeft}<br>
                moveRight: ${playerInput.moveRight}<br>
                jump: ${playerInput.jump} (held: ${playerInput.jumpHeld})<br>
                dash: ${playerInput.dash}<br>
                block: ${playerInput.block}<br>
                pause: ${playerInput.pause}<br>
                enter: ${playerInput.enter}<br>
                escape: ${playerInput.escape}
            `;

        // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã®ç‰¹åˆ¥ãƒ†ã‚¹ãƒˆ
        if (inputManager.isKeyPressed("Space")) {
          testResults.push(
            "âœ… ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼æŠ¼ä¸‹æ¤œå‡º: " + new Date().toLocaleTimeString()
          );
          updateTestResults();
        }

        if (playerInput.jump) {
          testResults.push(
            "âœ… ã‚¸ãƒ£ãƒ³ãƒ—ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡º: " + new Date().toLocaleTimeString()
          );
          updateTestResults();
        }
      }

      // ãƒ†ã‚¹ãƒˆçµæœã‚’æ›´æ–°
      function updateTestResults() {
        const resultsDiv = document.getElementById("test-results");
        resultsDiv.innerHTML = testResults.slice(-10).join("<br>"); // æœ€æ–°10ä»¶ã‚’è¡¨ç¤º
      }

      // æ‰‹å‹•ãƒ†ã‚¹ãƒˆé–¢æ•°
      function testSpaceKey() {
        if (!inputManager) {
          testResults.push("âŒ InputManagerãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“");
          updateTestResults();
          return;
        }

        const isSpaceHeld = inputManager.isKeyHeld("Space");
        const isSpacePressed = inputManager.isKeyPressed("Space");
        const isJumpAction = inputManager.isActionPressed("jump");

        testResults.push(
          `ğŸ” æ‰‹å‹•ãƒ†ã‚¹ãƒˆ - Space held: ${isSpaceHeld}, pressed: ${isSpacePressed}, jump: ${isJumpAction}`
        );
        updateTestResults();
      }

      // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
      document.addEventListener("keydown", (event) => {
        console.log("Raw keydown event:", event.code, event.key);
        testResults.push(`ğŸ” Raw keydown: ${event.code} (${event.key})`);
        updateTestResults();
      });

      document.addEventListener("keyup", (event) => {
        console.log("Raw keyup event:", event.code, event.key);
        testResults.push(`ğŸ” Raw keyup: ${event.code} (${event.key})`);
        updateTestResults();
      });

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
      window.addEventListener("load", () => {
        initInputManager();
      });

      // æ‰‹å‹•ãƒ†ã‚¹ãƒˆç”¨ã®ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
      document.addEventListener("DOMContentLoaded", () => {
        const button = document.createElement("button");
        button.textContent = "ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼æ‰‹å‹•ãƒ†ã‚¹ãƒˆ";
        button.onclick = testSpaceKey;
        button.style.cssText = "padding: 10px; margin: 10px; font-size: 16px;";
        document.body.appendChild(button);
      });
    </script>
  </body>
</html>
